<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fruit Slice Power+</title>

<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
    font-family: Arial, sans-serif;
    touch-action: none;
  }

  #topUI {
    position: fixed;
    top: 10px;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 20px;
    z-index: 50;
  }

  .ui-box {
    background: #fff;
    padding: 8px 16px;
    border-radius: 14px;
    font-size: 17px;
    font-weight: bold;
  }

  button {
    margin-left: 8px;
    padding: 8px 16px;
    border: none;
    border-radius: 14px;
    font-size: 15px;
    font-weight: bold;
    cursor: pointer;
  }

  #btnRestart { background: #28a745; color: white; }
  #btnHome { background: #333; color: white; }
</style>
</head>

<body>

<div id="topUI">
  <div class="ui-box">Score: <span id="score">0</span></div>

  <div>
    <button id="btnRestart" onclick="restartGame()">Restart</button>
    <button id="btnHome" onclick="location.href='index.html'">Home</button>
  </div>
</div>

<canvas id="gameCanvas"></canvas>

<script>
// =========================
// CANVAS SETUP
// =========================
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize", () => {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
});

// =========================
// SOUNDS
// =========================
const sliceSound = new Audio("sounds/slice.mp3");
const bombSound = new Audio("sounds/bomb.mp3");

// =========================
// GAME VARIABLES
// =========================
let fruits = [];
let score = 0;
let isGameOver = false;
let lastSpawn = 0;

// =========================
// FRUIT OBJECT
// =========================
class Fruit {
  constructor(type) {
    this.type = type;

    this.x = Math.random() * canvas.width;
    this.y = canvas.height + 40;

    this.radius = 40;
    this.speedX = (Math.random() - 0.5) * 6;
    this.speedY = - (15 + Math.random() * 6);
    this.gravity = 0.4;

    this.sliced = false;
  }

  draw() {
    if (this.type === "bomb") {
      ctx.fillStyle = "black";
      ctx.beginPath();
      ctx.arc(this.x, this.y, 40, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = "red";
      ctx.lineWidth = 4;
      ctx.stroke();
      return;
    }

    ctx.fillStyle = "#ff4d4d";
    ctx.beginPath();
    ctx.arc(this.x, this.y, 40, 0, Math.PI * 2);
    ctx.fill();

    ctx.fillStyle = "#fff";
    ctx.fillRect(this.x - 10, this.y - 20, 20, 5);
  }

  update() {
    this.x += this.speedX;
    this.y += this.speedY;
    this.speedY += this.gravity;
  }
}

// =========================
// SPAWN FRUIT
// =========================
function spawnFruit() {
  let type = Math.random() < 0.15 ? "bomb" : "fruit";
  fruits.push(new Fruit(type));
}

// =========================
// SLICE DETECTION
// =========================
let lastX = null;
let lastY = null;

function sliceCheck(x, y) {
  fruits.forEach(f => {
    const dist = Math.hypot(f.x - x, f.y - y);

    if (dist < f.radius && !f.sliced) {
      f.sliced = true;

      if (f.type === "bomb") {
        bombSound.currentTime = 0;
        bombSound.play();
        gameOver();
      } else {
        score++;
        document.getElementById("score").innerText = score;

        sliceSound.currentTime = 0;
        sliceSound.play();

        // Slice effect
        ctx.strokeStyle = "yellow";
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
      }
    }
  });
}

// =========================
// TOUCH / MOUSE INPUT
// =========================
function handleInput(e) {
  let x, y;

  if (e.touches) {
    x = e.touches[0].clientX;
    y = e.touches[0].clientY;
  } else {
    x = e.clientX;
    y = e.clientY;
  }

  if (lastX !== null) sliceCheck(x, y);

  lastX = x;
  lastY = y;
}

window.addEventListener("mousemove", handleInput);
window.addEventListener("touchmove", handleInput);

// Reset swipe
window.addEventListener("mouseup", () => { lastX = lastY = null; });
window.addEventListener("touchend", () => { lastX = lastY = null; });

// =========================
// GAME LOOP
// =========================
function gameLoop(timestamp) {
  if (isGameOver) return;

  ctx.clearRect(0, 0, canvas.width, canvas.height);

  // Spawn fruits every 700ms
  if (timestamp - lastSpawn > 700) {
    spawnFruit();
    lastSpawn = timestamp;
  }

  fruits.forEach((f, index) => {
    f.update();
    f.draw();

    if (f.y > canvas.height + 100) {
      fruits.splice(index, 1);
    }
  });

  requestAnimationFrame(gameLoop);
}

requestAnimationFrame(gameLoop);

// =========================
// GAME OVER
// =========================
function gameOver() {
  isGameOver = true;
  alert("ðŸ’¥ BOOM! Kena bomb Bro!\nScore: " + score);
}

// =========================
// RESTART
// =========================
function restartGame() {
  location.reload();
}

</script>

</body>
</html>
