<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fruit Slice Game</title>

<style>
    body {
        margin: 0;
        overflow: hidden;
        background: #111;
        font-family: Arial;
        touch-action: none;
    }

    canvas {
        display: block;
    }

    .top-buttons {
        position: fixed;
        top: 15px;
        left: 15px;
        z-index: 10;
    }

    .btn {
        background: #fff;
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        font-size: 16px;
        margin-right: 10px;
        cursor: pointer;
    }

    .btn:hover {
        opacity: 0.8;
    }

    #scoreBox {
        position: fixed;
        top: 15px;
        right: 15px;
        color: #fff;
        font-size: 20px;
        font-weight: bold;
    }
</style>
</head>
<body>

<div class="top-buttons">
    <button class="btn" onclick="goHome()">Home</button>
    <button class="btn" onclick="restartGame()">Restart</button>
</div>

<div id="scoreBox">Score: 0</div>
<canvas id="gameCanvas"></canvas>

<script>
/* -------------------
   CANVAS SETUP
------------------- */
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

/* -------------------
   LOAD FRUIT IMAGES
------------------- */
const fruitImages = {
    apple: "images/apple.png",
    orange: "images/orange.png",
    banana: "images/banana.png",
    watermelon: "images/watermelon.png"
};

function loadImage(src) {
    const img = new Image();
    img.src = src;
    return img;
}

const loadedFruits = {
    apple: loadImage(fruitImages.apple),
    orange: loadImage(fruitImages.orange),
    banana: loadImage(fruitImages.banana),
    watermelon: loadImage(fruitImages.watermelon)
};

/* -------------------
   SLICE SOUND
------------------- */
const sliceSound = new Audio("sounds/slice.mp3");

/* -------------------
   FRUIT OBJECT
------------------- */
let fruits = [];
let score = 0;

function randomFruit() {
    const keys = Object.keys(loadedFruits);
    const pick = keys[Math.floor(Math.random() * keys.length)];

    return {
        type: pick,
        img: loadedFruits[pick],
        x: Math.random() * canvas.width,
        y: canvas.height + 50,
        size: 90,
        speedY: -(10 + Math.random() * 5),
        gravity: 0.3,
        sliced: false,
    };
}

function spawnFruit() {
    fruits.push(randomFruit());
}

setInterval(spawnFruit, 1000);

/* -------------------
   DRAW FRUIT
------------------- */
function drawFruit(f) {
    if (!f.sliced) {
        ctx.drawImage(f.img, f.x, f.y, f.size, f.size);
    } else {
        // Draw slice halves
        ctx.save();

        // LEFT HALF
        ctx.translate(f.x + f.size / 2, f.y + f.size / 2);
        ctx.rotate(-0.4);
        ctx.drawImage(f.img, -f.size/2 - 20, -f.size/2, f.size/2, f.size);

        // RIGHT HALF
        ctx.rotate(0.8);
        ctx.drawImage(f.img, 0, -f.size/2, f.size/2, f.size);

        ctx.restore();
    }
}

/* -------------------
   UPDATE FRUIT MOVEMENT
------------------- */
function updateFruit(f) {
    f.y += f.speedY;
    f.speedY += f.gravity;

    if (f.y > canvas.height + 100) {
        fruits.splice(fruits.indexOf(f), 1);
    }
}

/* -------------------
   SLICE DETECTION
------------------- */
let lastX = null;
let lastY = null;

function checkSlice(x, y) {
    fruits.forEach(f => {
        if (!f.sliced &&
            x > f.x && x < f.x + f.size &&
            y > f.y && y < f.y + f.size) {

            sliceFruit(f);
        }
    });
}

function sliceFruit(f) {
    f.sliced = true;

    score += 1;
    document.getElementById("scoreBox").textContent = "Score: " + score;

    sliceSound.currentTime = 0;
    sliceSound.play();

    // Remove sliced fruit after animation
    setTimeout(() => {
        fruits.splice(fruits.indexOf(f), 1);
    }, 500);
}

/* -------------------
   MOUSE & TOUCH EVENTS
------------------- */
function handleMove(e) {
    let x, y;

    if (e.touches) {
        x = e.touches[0].clientX;
        y = e.touches[0].clientY;
    } else {
        x = e.clientX;
        y = e.clientY;
    }

    if (lastX !== null) {
        checkSlice(x, y);
    }

    lastX = x;
    lastY = y;
}

canvas.addEventListener("mousemove", handleMove);
canvas.addEventListener("touchmove", handleMove);

/* -------------------
   GAME LOOP
------------------- */
function gameLoop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    fruits.forEach(f => {
        updateFruit(f);
        drawFruit(f);
    });

    requestAnimationFrame(gameLoop);
}
gameLoop();

/* -------------------
   BUTTON FUNCTIONS
------------------- */
function restartGame() {
    fruits = [];
    score = 0;
    document.getElementById("scoreBox").textContent = "Score: 0";
}

function goHome() {
    window.location.href = "index.html";
}

</script>

</body>
</html>
